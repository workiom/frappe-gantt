<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Task Name Column Test</title>
    <link rel="stylesheet" href="dist/frappe-gantt.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .controls {
            margin: 20px 0;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .chart {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 20px 0;
            height: 500px;

            > *,
            > * > .gantt-container {
                height: 100% !important;
            }
        }
        label {
            display: inline-flex;
            align-items: center;
            margin-right: 20px;
            cursor: pointer;
        }
        input[type="checkbox"] {
            margin-right: 5px;
        }
        .section {
            margin: 30px 0;
        }
        .section h2 {
            color: #555;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 5px;
        }
        /* Custom task row styles */
        .custom-task-row {
            display: flex;
            flex-direction: column;
            padding: 4px 8px;
            height: 100%;
            justify-content: center;
        }
        .custom-task-row .task-title {
            font-weight: 500;
            font-size: 14px;
            color: #333;
            margin-bottom: 2px;
        }
        .custom-task-row .task-meta {
            display: flex;
            gap: 8px;
            font-size: 11px;
            color: #666;
        }
        .custom-task-row .progress-badge {
            background: #4CAF50;
            color: white;
            padding: 1px 6px;
            border-radius: 3px;
            font-weight: 500;
        }
        .custom-task-row .progress-badge.low {
            background: #ff9800;
        }
        .custom-task-row .progress-badge.none {
            background: #9e9e9e;
        }
        .custom-task-row .task-id {
            color: #999;
            font-style: italic;
        }
    </style>
    <script src="dist/frappe-gantt.umd.js"></script>
</head>
<body>
    <div class="container">
        <h1>Task Name Column Feature Test</h1>

        <div class="section">
            <h2>Default (Column Disabled)</h2>
            <p>This gantt chart shows the default behavior without the task name column.</p>
            <div class="chart" id="gantt-default"></div>
        </div>

        <div class="section">
            <h2>With Task Name Column (Enabled)</h2>
            <p>This gantt chart has the task name column enabled on the left side.</p>
            <div class="controls">
                <label>
                    <input type="checkbox" id="toggle-column" checked>
                    Enable Task Name Column
                </label>
                <label>
                    <input type="checkbox" id="toggle-rtl">
                    RTL Mode
                </label>
            </div>
            <div class="chart" id="gantt-with-column"></div>
        </div>

        <div class="section">
            <h2>With Custom Content (DOM Element)</h2>
            <p>Task name column using a custom content function that <strong>returns a DOM element</strong>. This approach is useful when you need to create complex interactive elements or attach event listeners.</p>
            <div class="chart" id="gantt-custom-width"></div>
        </div>

        <div class="section">
            <h2>With Custom Content (HTML String)</h2>
            <p>Task name column using a custom content function that <strong>returns an HTML string</strong>. This approach is simpler and works well for displaying formatted text with styling.</p>
            <div class="chart" id="gantt-custom-content"></div>
        </div>

        <div class="section">
            <h2>Tasks Without Start/End Dates</h2>
            <p>This example demonstrates how the gantt chart handles tasks where some tasks don't have start and end dates defined. Tasks without dates can still be displayed in the task column.</p>
            <div class="chart" id="gantt-no-dates"></div>
        </div>
    </div>

    <script>
        // Helper functions
        const daysSince = (dx) => {
            const rawToday = new Date();
            const today = Date.UTC(
                rawToday.getFullYear(),
                rawToday.getMonth(),
                rawToday.getDate(),
            ) + new Date().getTimezoneOffset() * 60000;
            return new Date(today + dx * 86400000);
        };

        // Sample tasks
        const tasks = [
            {
                start: daysSince(-7),
                end: daysSince(-3),
                name: 'Initial brainstorming and planning',
                id: 'Task 0',
                progress: 100,
            },
            {
                start: daysSince(-3),
                end: daysSince(2),
                name: 'Develop wireframe',
                id: 'Task 1',
                progress: 75,
                dependencies: 'Task 0',
            },
            {
                start: daysSince(0),
                duration: '4d',
                name: 'Client meeting',
                id: 'Task 2',
                progress: 50,
            },
            {
                start: daysSince(2),
                duration: '7d',
                name: 'Create prototype',
                id: 'Task 3',
                dependencies: 'Task 2',
                progress: 30,
            },
            {
                start: daysSince(4),
                duration: '5d',
                name: 'Test design with users',
                dependencies: 'Task 2',
                id: 'Task 4',
                progress: 10,
            },
            {
                start: daysSince(6),
                end: daysSince(11),
                name: 'Write technical documentation',
                id: 'Task 5',
                progress: 0,
            },
            {
                start: daysSince(9),
                duration: '3d',
                name: 'Prepare demo',
                id: 'Task 6',
                progress: 0,
            },
            {
                name: 'Budget approval',
                id: 'Task 7',
                progress: 60,
            },
            {
                start: daysSince(11),
                end: daysSince(14),
                name: 'Final client review',
                id: 'Task 8',
                progress: 0,
            },
            {
                start: daysSince(14),
                duration: '6d',
                name: 'Implement feedback',
                id: 'Task 9',
                dependencies: 'Task 8',
                progress: 0,
            },
            {
                start: daysSince(15),
                duration: '4d',
                name: 'Quality assurance testing',
                id: 'Task 10',
                progress: 0,
            },
            {
                start: daysSince(17),
                duration: '3d',
                name: 'Bug fixes and refinements',
                id: 'Task 11',
                dependencies: 'Task 10',
                progress: 0,
            },
            {
                start: daysSince(19),
                duration: '2d',
                name: 'Performance optimization',
                id: 'Task 12',
                progress: 0,
            },
            {
                start: daysSince(20),
                duration: '5d',
                name: 'Security audit',
                id: 'Task 13',
                progress: 0,
            },
            {
                start: daysSince(21),
                duration: '4d',
                name: 'User acceptance testing',
                id: 'Task 14',
                dependencies: 'Task 11',
                progress: 0,
            },
            {
                start: daysSince(24),
                duration: '3d',
                name: 'Deploy to staging',
                id: 'Task 15',
                dependencies: 'Task 13,Task 14',
                progress: 0,
            },
            {
                start: daysSince(26),
                duration: '2d',
                name: 'Staging environment tests',
                id: 'Task 16',
                dependencies: 'Task 15',
                progress: 0,
            },
            {
                start: daysSince(28),
                duration: '1d',
                name: 'Production deployment',
                id: 'Task 17',
                dependencies: 'Task 16',
                progress: 0,
            },
            {
                start: daysSince(29),
                duration: '3d',
                name: 'Post-launch monitoring',
                id: 'Task 18',
                dependencies: 'Task 17',
                progress: 0,
            },
        ];

        // Create gantt charts
        const ganttDefault = new Gantt('#gantt-default', tasks, {
            view_mode: 'Day',
            popup_on: 'hover',
            infinite_padding: false,
        });

        let ganttWithColumn = new Gantt('#gantt-with-column', tasks, {
            view_mode: 'Day',
            popup_on: 'hover',
            infinite_padding: false,
            task_column: {
                enabled: true,
                width: 200,
                header_text: 'Task Name',
            },
        });

        // Example 1: Custom content using DOM element
        // The content function receives the task object and can return a DOM element
        const ganttCustomWidth = new Gantt('#gantt-custom-width', tasks, {
            view_mode: 'Day',
            popup_on: 'hover',
            infinite_padding: false,
            task_column: {
                enabled: true,
                width: 250,
                header_text: 'Tasks',
                content: (task) => {
                    // Create DOM elements
                    const container = document.createElement('div');
                    container.style.padding = '4px 8px';
                    container.style.display = 'flex';
                    container.style.flexDirection = 'column';
                    container.style.justifyContent = 'center';
                    container.style.height = '100%';

                    const title = document.createElement('div');
                    title.textContent = task.name;
                    title.style.fontWeight = '500';
                    title.style.fontSize = '13px';
                    title.style.marginBottom = '3px';

                    const badge = document.createElement('span');
                    badge.textContent = `${task.progress}% complete`;
                    badge.style.fontSize = '11px';
                    badge.style.color = '#666';
                    badge.style.display = 'inline-block';

                    container.appendChild(title);
                    container.appendChild(badge);

                    return container;
                }
            },
        });

        // Example 2: Custom content using HTML string
        // The content function can also return an HTML string for simpler use cases
        const ganttCustomContent = new Gantt('#gantt-custom-content', tasks, {
            view_mode: 'Day',
            popup_on: 'hover',
            infinite_padding: false,
            task_column: {
                enabled: true,
                width: 300,
                header_text: 'Task Details',
                content: (task) => {
                    // Determine progress badge class
                    let progressClass = 'progress-badge';
                    if (task.progress === 0) {
                        progressClass += ' none';
                    } else if (task.progress < 50) {
                        progressClass += ' low';
                    }

                    // Return custom HTML string
                    return `
                        <div class="custom-task-row">
                            <div class="task-title">${task.name}</div>
                            <div class="task-meta">
                                <span class="${progressClass}">${task.progress}%</span>
                                <span class="task-id">${task.id}</span>
                            </div>
                        </div>
                    `;
                }
            },
        });

        // Toggle controls
        document.getElementById('toggle-column').addEventListener('change', (e) => {
            ganttWithColumn.update_options({
                task_column: {
                    enabled: e.target.checked,
                    width: 200,
                    header_text: 'Task Name',
                },
            });
        });

        document.getElementById('toggle-rtl').addEventListener('change', (e) => {
            ganttWithColumn.update_options({
                isRTL: e.target.checked,
                task_column: {
                    enabled: document.getElementById('toggle-column').checked,
                    width: 200,
                    header_text: 'Task Name',
                },
            });
        });

        // Example with tasks that don't have start/end dates
        const tasksWithoutDates = [
            {
                name: 'Project kickoff',
                id: 'Task A',
                progress: 100,
            },
            {
                name: 'Requirements gathering',
                id: 'Task B',
                progress: 70,
            },
            {
                name: 'Stakeholder approval pending',
                id: 'Task C',
                progress: 50,
            },
            {
                name: 'Design phase',
                id: 'Task D',
                progress: 40,
            },
            {
                name: 'Budget review',
                id: 'Task E',
                progress: 0,
            },
            {
                name: 'Development sprint 1',
                id: 'Task F',
                progress: 20,
            },
            {
                name: 'Resource allocation',
                id: 'Task G',
                progress: 30,
            },
            {
                name: 'Testing phase',
                id: 'Task H',
                progress: 0,
            },
            {
                name: 'Documentation needed',
                id: 'Task I',
                progress: 0,
            },
            {
                name: 'Client feedback review',
                id: 'Task J',
                progress: 60,
            },
            {
                name: 'Final delivery',
                id: 'Task K',
                progress: 0,
            },
        ];

        const ganttNoDates = new Gantt('#gantt-no-dates', tasksWithoutDates, {
            view_mode: 'Day',
            popup_on: 'hover',
            infinite_padding: false,
            task_column: {
                enabled: true,
                width: 250,
                header_text: 'Task Name',
                content: (task) => {
                    // Determine progress badge styling
                    let progressClass = task.progress === 0 ? 'none' : task.progress < 50 ? 'low' : '';

                    return `
                        <div class="custom-task-row">
                            <div class="task-title">${task.name}</div>
                            <div class="task-meta">
                                <span class="progress-badge ${progressClass}">${task.progress}%</span>
                                <span class="task-id">${task.id}</span>
                            </div>
                        </div>
                    `;
                }
            },
            on_date_change: (task, start, end) => {
                alert(`[on_date_change]\nTask "${task.name}" dates assigned!\nStart: ${start.toLocaleDateString()}\nEnd: ${end.toLocaleDateString()}`);
            },
            on_after_date_change: (task, start, end) => {
                alert(`[on_after_date_change]\nTask "${task.name}" dates modified by drag/resize!\nStart: ${start.toLocaleDateString()}\nEnd: ${end.toLocaleDateString()}`);
            },
        });
    </script>
</body>
</html>
